---
import AdminLayout from "@/components/admin/AdminLayout.astro";
import BlogPostForm from "@/components/admin/forms/BlogPostForm";

const { id } = Astro.params;

if (!id) {
  return Astro.redirect("/admin/blog");
}

const db = Astro.locals.runtime.env.DB;

const post = await db
  .prepare("SELECT * FROM blog_posts WHERE id = ?")
  .bind(id)
  .first();

if (!post) {
  return Astro.redirect("/admin/blog");
}
---

<AdminLayout title={`Edit: ${post.title}`} activeNav="blog posts">
  <div class="page-header">
    <div>
      <a href="/admin/blog" class="back-link">‚Üê Back to Posts</a>
      <h1 class="page-title">Edit Blog Post</h1>
    </div>
    {post.status === 'published' && (
      <a href={`/blog/${post.slug}`} class="btn btn-secondary" target="_blank">
        View Published Post
      </a>
    )}
  </div>

  <div class="card">
    <BlogPostForm
      client:load
      initialData={{
        id: post.id as number,
        title: post.title as string,
        content: post.content as string,
        excerpt: (post.excerpt as string) || "",
        featured_image: (post.featured_image as string) || "",
        status: post.status as "draft" | "published",
        meta_title: (post.meta_title as string) || "",
        meta_description: (post.meta_description as string) || "",
      }}
    />
  </div>
</AdminLayout>

<style>
  .back-link {
    display: inline-block;
    color: #718096;
    text-decoration: none;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }

  .back-link:hover {
    color: #2c5282;
  }
</style>
